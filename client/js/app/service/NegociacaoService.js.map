{"version":3,"sources":["../../app-es6/service/NegociacaoService.js"],"names":["HttpService","ConnectionFactory","Negociacao","NegociacaoDAO","NegociacaoService","_http","_urlSemana","_urlSemanaAnterior","_urlSemanaRetrasada","Promise","all","obterNegociacoesSemana","obterNegociacoesSemanaAnterior","obterNegociacoesSemanaRetrasada","then","periodos","reduce","flat","item","concat","catch","Error","error","get","lista","map","Date","obj","data","quantidade","valor","getConnection","connection","dao","listAll","negociacao","add","clear","listaAtual","obterNegociacoes","negociacoes","filter","some","JSON","stringify"],"mappings":"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","file":"NegociacaoService.js","sourcesContent":["import {HttpService} from './HttpService';\r\nimport {ConnectionFactory} from './ConnectionFactory';\r\nimport {Negociacao} from '../model/Negociacao';\r\nimport {NegociacaoDAO} from '../dao/NegociacaoDAO';\r\n\r\nexport class NegociacaoService\r\n{\r\n      constructor()\r\n      {\r\n          this._http = new HttpService();\r\n          this._urlSemana          = 'negociacoes/semana';\r\n          this._urlSemanaAnterior  = 'negociacoes/anterior';\r\n          this._urlSemanaRetrasada = 'negociacoes/retrasada';\r\n      }\r\n\r\n      obterNegociacoes()\r\n      {\r\n          return  Promise.all([\r\n                     this.obterNegociacoesSemana(),\r\n                     this.obterNegociacoesSemanaAnterior(),\r\n                     this.obterNegociacoesSemanaRetrasada()\r\n                  ])\r\n                  .then(periodos=>{\r\n                     return periodos.reduce((flat,item)=>flat.concat(item),[])\r\n                  })\r\n                  .catch(error=>{\r\n                     throw new Error(error)\r\n                   });\r\n      }\r\n\r\n      obterNegociacoesSemana()\r\n      {\r\n          return this._http\r\n                       .get(this._urlSemana)\r\n                       .then(lista=>lista.map(obj=>new Negociacao(new Date(obj.data),obj.quantidade,obj.valor)))\r\n                       .catch(error=> {throw new Error(\"Não foi possível obter as negociações da semana\")});\r\n      }\r\n\r\n      obterNegociacoesSemanaAnterior()\r\n      {\r\n          return this._http\r\n                     .get(this._urlSemanaAnterior)\r\n                     .then(lista=>lista.map(obj=>new Negociacao(new Date(obj.data),obj.quantidade,obj.valor)))\r\n                     .catch(error=> {throw new Error(\"Não foi possível obter as negociações da semana anterior\")});\r\n      }\r\n\r\n      obterNegociacoesSemanaRetrasada()\r\n      {\r\n          return this._http\r\n                       .get(this._urlSemanaRetrasada)\r\n                       .then(lista=>lista.map(obj=>new Negociacao(new Date(obj.data),obj.quantidade,obj.valor)))\r\n                       .catch(error=> {throw new Error(\"Não foi possível obter as negociações da semana retrasada\")});\r\n      }\r\n\r\n      listaAll()\r\n      {\r\n          return ConnectionFactory.getConnection()\r\n                           .then(connection=>new NegociacaoDAO(connection))\r\n                           .then(dao=> dao.listAll())\r\n                           .catch(error=>{throw new Error(error)});\r\n      }\r\n\r\n      add(negociacao)\r\n      {\r\n         return ConnectionFactory.getConnection()\r\n                          .then(connection => new NegociacaoDAO(connection))\r\n                          .then(dao => dao.add(negociacao))\r\n                          .then(()=>'Negociação adicionada com sucesso')\r\n                          .catch(error=>{throw new Error('Não foi possível adicionar a negociação')});\r\n      }\r\n\r\n      clear()\r\n      {\r\n           return ConnectionFactory.getConnection()\r\n                         .then(connection => new NegociacaoDAO(connection))\r\n                         .then(dao=> dao.clear())\r\n                         .then(()=> 'Negociações apagadas com sucesso')\r\n                         .catch(error=>{throw new Error('Não foi possível remover as negociações')});\r\n      }\r\n\r\n      import(listaAtual)\r\n      {\r\n        return this.obterNegociacoes()\r\n               .then(negociacoes =>negociacoes.filter(negociacao =>\r\n                        !listaAtual.some(item =>JSON.stringify(negociacao) == JSON.stringify(item))\r\n                      )\r\n                )\r\n               .catch(error=>{throw new Error(error)});\r\n      }\r\n}\r\n"]}